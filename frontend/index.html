<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>房地产代币化平台 - mUSDT测试版</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="network-status">
                <span class="network-indicator" id="network-indicator"></span>
                <span id="network-name">未连接网络</span>
            </div>
            
            <h1><i class="fas fa-building"></i> 房地产代币化平台</h1>
            <p>基于区块链的房地产投资解决方案 - 使用 mUSDT 测试代币</p>
            
            <div class="solution-box">
                <h3><i class="fas fa-lightbulb"></i> 问题修复说明</h3>
                <ul class="solution-list">
                    <li><strong>管理员检查修复</strong>：修复了管理员状态检查失败的问题</li>
                    <li><strong>分红领取优化</strong>：即使显示无可领分红，也可尝试领取</li>
                    <li><strong>错误处理增强</strong>：提供更友好的错误提示</li>
                    <li><strong>状态监控</strong>：添加交易状态监控和Etherscan链接</li>
                </ul>
            </div>
            
            <div class="network-info">
                <strong>当前网络状态:</strong> <span id="chain-info">加载中...</span>
                <div class="token-value" id="total-value">房产总价值: $0.00</div>
                
                <div class="network-controls">
                    <button id="connect-wallet" class="btn btn-connect">
                        <i class="fas fa-plug"></i> 连接钱包
                    </button>
                    <button id="switch-network" class="btn btn-network">
                        <i class="fas fa-exchange-alt"></i> 切换到Sepolia
                    </button>
                </div>
            </div>
        </header>
        
        <div class="card">
            <h2><i class="fas fa-wallet"></i> 钱包信息</h2>
            <div class="wallet-section">
                <div class="wallet-info">
                    <div class="info-row">
                        <span class="label">连接状态:</span>
                        <span class="value">
                            <span class="status-indicator" id="status-indicator"></span>
                            <span id="connection-status">未连接</span>
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">钱包地址:</span>
                        <span class="value" id="account-address">未连接</span>
                    </div>
                    <div class="info-row highlight">
                        <span class="label">mUSDT 余额:</span>
                        <span class="value" id="usdt-balance">0.00</span>
                    </div>
                    <div class="info-row highlight">
                        <span class="label">房产代币余额:</span>
                        <span class="value" id="token-balance">0.00</span>
                    </div>
                    <div class="info-row highlight">
                        <span class="label">可领分红:</span>
                        <span class="value" id="dividend-balance">0.00</span>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="claim-btn" class="btn">
                        <i class="fas fa-money-bill-wave"></i> 领取分红
                    </button>
                    <div class="transaction-status" id="transaction-status">
                        <span class="spinner"></span>
                        <span id="status-message">交易处理中...</span>
                        <a href="#" id="tx-link" target="_blank" style="display: none; margin-top: 10px; color: #3498db;">在Etherscan查看交易</a>
                    </div>
                </div>
            </div>
            
            <div class="property-grid">
                <div class="property-card">
                    <img src="https://images.unsplash.com/photo-1564013799919-ab600027ffc6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="房产图片" class="property-image">
                    <h3><i class="fas fa-home"></i> 高端别墅 - 上海</h3>
                    <div class="info-row">
                        <span class="label">房产价值:</span>
                        <span class="value" id="property-value">0.00</span>
                    </div>
                    <div class="info-row">
                        <span class="label">最小购买额:</span>
                        <span class="value" id="min-purchase">0.00</span>
                    </div>
                    <div class="property-description">
                        位于上海市中心的高端别墅，占地500平方米，配备豪华装修和私人花园。
                    </div>
                </div>
                
                <div class="property-card">
                    <h3><i class="fas fa-file-contract"></i> 房产文件</h3>
                    <div class="info-row">
                        <span class="label">IPFS 链接:</span>
                        <a href="#" id="ipfs-link" target="_blank" style="color: #3498db;">查看房产文件</a>
                    </div>
                    <div class="info-row">
                        <span class="label">产权证书:</span>
                        <a href="#" target="_blank" style="color: #3498db;">查看产权证</a>
                    </div>
                    <div class="info-row">
                        <span class="label">评估报告:</span>
                        <a href="#" target="_blank" style="color: #3498db;">下载评估报告</a>
                    </div>
                </div>
                
                <div class="property-card">
                    <h3><i class="fas fa-lock"></i> 锁定期状态</h3>
                    <div class="info-row">
                        <span class="label">锁定期剩余:</span>
                        <span class="value" id="lock-remaining">未连接</span>
                    </div>
                    <div class="info-row">
                        <span class="label">锁定期结束:</span>
                        <span class="value" id="lock-end-date">未连接</span>
                    </div>
                    <div class="info-row">
                        <span class="label">当前状态:</span>
                        <span class="value" id="lock-status">未连接</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2><i class="fas fa-exchange-alt"></i> 平台操作</h2>
            <div class="action-grid">
                <div class="action-card">
                    <h3><i class="fas fa-shopping-cart"></i> 购买房产代币</h3>
                    <div class="input-group">
                        <label for="buy-amount">mUSDT 数量 (最小 <span id="min-purchase-label">0.00</span> mUSDT)</label>
                        <input type="number" id="buy-amount" placeholder="输入购买数量">
                    </div>
                    <button id="buy-btn" class="btn">
                        <i class="fas fa-cart-plus"></i> 购买房产代币
                    </button>
                    <div class="property-description">
                        使用 mUSDT 购买房产代币，代表您对该房产的所有权份额。
                    </div>
                </div>
                
                <div class="action-card">
                    <h3><i class="fas fa-recycle"></i> 赎回房产代币</h3>
                    <div class="input-group">
                        <label for="redeem-amount">代币数量</label>
                        <input type="number" id="redeem-amount" placeholder="输入赎回数量">
                    </div>
                    <button id="redeem-btn" class="btn">
                        <i class="fas fa-exchange-alt"></i> 赎回代币
                    </button>
                    <div class="property-description">
                        赎回您的房产代币，按比例获得房产价值对应的 mUSDT。
                    </div>
                </div>
                
                <div class="action-card">
                    <h3><i class="fas fa-money-bill-wave"></i> 领取分红</h3>
                    <div class="input-group">
                        <label>可领取分红: <span id="claimable-dividend">0.00</span> mUSDT</label>
                    </div>
                    <button id="claim-btn2" class="btn">
                        <i class="fas fa-hand-holding-usd"></i> 立即领取分红
                    </button>
                    <div class="dividend-notice">
                        <i class="fas fa-exclamation-circle"></i>
                        <strong>注意：</strong> 即使显示无可领分红，您也可以尝试领取。合约状态可能未及时更新。
                    </div>
                </div>
            </div>
            
            <div class="admin-section" id="admin-section" style="display: none;">
                <h3><i class="fas fa-user-shield"></i> 管理员功能</h3>
                <div class="action-grid">
                    <div class="action-card">
                        <h3><i class="fas fa-piggy-bank"></i> 存入分红</h3>
                        <div class="input-group">
                            <label for="deposit-amount">mUSDT 数量</label>
                            <input type="number" id="deposit-amount" placeholder="输入存入数量">
                        </div>
                        <button id="deposit-btn" class="btn">
                            <i class="fas fa-coins"></i> 存入分红
                        </button>
                        <div class="property-description">
                            将房产租金收入存入分红池，供投资者领取。
                        </div>
                    </div>
                    
                    <div class="action-card">
                        <h3><i class="fas fa-chart-line"></i> 更新房产价值</h3>
                        <div class="input-group">
                            <label for="property-value-input">新房产价值 (mUSDT)</label>
                            <input type="number" id="property-value-input" placeholder="输入新价值">
                        </div>
                        <button id="update-property-btn" class="btn">
                            <i class="fas fa-sync"></i> 更新价值
                        </button>
                        <div class="property-description">
                            根据市场评估更新房产价值，影响代币价格。
                        </div>
                    </div>
                    
                    <div class="action-card">
                        <h3><i class="fas fa-coins"></i> 铸造测试代币</h3>
                        <div class="input-group">
                            <label>铸造数量: 100,000 mUSDT</label>
                        </div>
                        <button id="mint-usdt-btn" class="btn btn-mint">
                            <i class="fas fa-hammer"></i> 铸造测试代币
                        </button>
                        <div class="property-description">
                            铸造测试用的 mUSDT 代币，仅管理员可用。
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2><i class="fas fa-file-alt"></i> 交易日志</h2>
            <div class="logs-container">
                <div class="log-header">
                    <h3>实时交易记录</h3>
                    <div class="log-controls">
                        <button id="clear-logs">清除日志</button>
                    </div>
                </div>
                <div class="log-box" id="log-box">
                    <div class="log-entry">
                        <span class="timestamp">[系统]</span>
                        <span class="log-info">应用程序已启动，等待连接钱包...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>房地产代币化平台 - 基于区块链的房地产投资解决方案 | Sepolia 测试网</p>
            <p>© 2025 房地产代币化平台 | 仅用于演示目的</p>
        </footer>
    </div>
<!-- 美观弹窗组件 -->
<div id="custom-alert" class="custom-alert">
  <div class="alert-content">
    <div class="alert-icon">
      <i class="fas fa-check-circle success-icon"></i>
      <i class="fas fa-exclamation-circle error-icon"></i>
      <i class="fas fa-info-circle info-icon"></i>
    </div>
    <h3 class="alert-title">提示</h3>
    <p class="alert-message" id="alert-message"></p>
    <div class="alert-actions">
      <button class="alert-button" onclick="closeCustomAlert()">确定</button>
    </div>
  </div>
</div>
    <script src="contract.js"></script>
    <script src="app.js"></script>
</body>
</html>